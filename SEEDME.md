# Seeding Cards

## I just want to seed my deck

If you're starting from scratch, run `decko setup`. This will create the databases 
specified in database.yml, the decko schema, and seed the tables.

If you have recently added a mod and need to take in its seed data, run `decko update`.

If you already have tables but want to start over, you can use `rake card:seed:replant`, 
which will truncate (as in, delete everything from) the existing tables and then
add the seed data.

You can also use Ruby-on-Rails db tasks (eg `rake db:reset`) for their original purpose, 
but caution is advised.

**Important**: always back up any valuable data before running any seed commands.


## Background: cards are both data _and_ code

Decko blurs the line between data and code. That is by design, because Decko helps people
who aren't coders do things that usually only coders do. In Decko terms, we extend the
capacities of sharks (ie advanced web users, so ultimately data manipulaters) into the
realm of the capacities of monkeys (ie code manipulaters). 

[Mods][1] often add cards used to configure things. These cards can
be influenced in data (by sharks), in code (by monkeys), or both.

**Important**: never refer to a card in shared code by its name (which can change)
or its id (which can vary from site to site). Instead always use a **codename**, which
is an independent permanent identifier. Often a card's codename is the same
as its name, but if a user changes the name, the codename remains the same, so the 
connection to the code is not broken.

## How seeding works

Every deck is configured with a list of mods as the source of its seed data. You can see
the list of mods using `decko runner 'puts Cardio.config.seed_mods'`. For a default
installation, that will return the following:

```
defaults
core
```

This tells you:

1. A complete set of seed data is ready to roll in the **defaults** mod. Specifically, it
   can be found in the `data/fixtures` directory of that mod. (You can use 
   `rake card:mod:list` to see where all your mods are installed.)
2. The defaults mod's seed data is based on seed data in the **core** mod.

If you were to look in the `data/fixtures` directory of either the _core_ mod or the 
_defaults_ mod, you would find directories of yaml files that correspond to tables in 
the database.

The deck described in the core mod is very small: just 11 cards. This is the minimal seed
dataset, and it is the only one in which these fixtures files are edited by hand. You
will notice several files with lots of IDs are needed for this small handful of cards.

This complexity is why all other seed fixtures are generated from simpler yaml files
which correspond not to the the final data structure in which cards are stored but 
the api by which cards are created. We call that pre-fixture data "pod" yaml.

The fixtures in the default mod are generated by:

1. seeding from the core mod
2. "eating" the seed data in all the mods that the defaults mod depends on
3. dumping the results to fixtures

This same pattern can be extended to other mods that depend on the defaults mod.  They
can create their own seed data by following the same steps as above, except that in 
step 1, they will start by seeding from the defaults mod. And then other mods can start 
from that seed data, and so on.

[1]: https://github.com/decko-commons/decko/blob/main/card/lib/cardio/mod.rb