// upload.js.coffee
(function(){decko.editors.init[".file-upload"]=function(){return decko.upload_file(this)},$.extend(decko,{upload_file:function(e){var t;return $(e).on("fileuploadsubmit",function(e,t){var i,a,r;return a=(i=$(this)).siblings(".attachment_card_name:first").attr("name"),r=i.siblings("#attachment_type_id").val(),t.formData={"card[type_id]":r,attachment_upload:a}}),t=$(e).closest("form").attr("action").indexOf("update")>-1?"card/update/"+$(e).siblings("#file_card_name").val():"card/create",$(e).fileupload({url:decko.path(t),dataType:"html",done:decko.doneFile,add:decko.chooseFile,progressall:decko.progressallFile})},chooseFile:function(e,t){var i;return t.form.find("button[type=submit]").attr("disabled",!0),i=$(this).closest(".card-editor"),$("#progress").show(),i.append('<input type="hidden" class="extra_upload_param" value="true" name="attachment_upload">'),i.append('<input type="hidden" class="extra_upload_param" value="preview_editor" name="view">'),t.submit(),i.find(".choose-file").hide(),i.find(".extra_upload_param").remove()},progressallFile:function(e,t){var i;return i=parseInt(t.loaded/t.total*100,10),$("#progress .progress-bar").css("width",i+"%")},doneFile:function(e,t){return $(this).closest(".card-editor").find(".chosen-file").replaceWith(t.result),t.form.find("button[type=submit]").attr("disabled",!1)}}),$(window).ready(function(){return $("body").on("click",".cancel-upload",function(){var e;return(e=$(this).closest(".card-editor")).find(".choose-file").show(),e.find(".chosen-file").empty(),e.find(".progress").show(),e.find("#progress .progress-bar").css("width","0%"),e.find("#progress").hide()}),$("body").on("submit","form",function(){var e;if((e=$(this).find(".file-upload[type=file]"))[0])return e.prop("disabled",!0)})})}).call(this);