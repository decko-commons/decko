// upload.js.coffee
(function(){$.extend(decko,{upload_file:function(e){var t;return $(e).on("fileuploadsubmit",function(e,t){var a,r,i;return r=(a=$(this)).siblings(".attachment_card_name:first").attr("name"),i=a.siblings("#attachment_type_id").val(),t.formData={"card[type_id]":i,attachment_upload:r}}),t=$(e).closest("form").attr("action").indexOf("update")>-1?"card/update/"+$(e).siblings("#file_card_name").val():"card/create",$(e).fileupload({url:decko.path(t),dataType:"html",done:decko.doneFile,add:decko.chooseFile,progressall:decko.progressallFile})},chooseFile:function(e,t){var a;return t.form.find("button[type=submit]").attr("disabled",!0),a=$(this).closest(".card-editor"),$("#progress").show(),a.append('<input type="hidden" class="extra_upload_param" value="true" name="attachment_upload">'),a.append('<input type="hidden" class="extra_upload_param" value="preview_editor" name="view">'),t.submit(),a.find(".choose-file").hide(),a.find(".extra_upload_param").remove()},progressallFile:function(e,t){var a;return a=parseInt(t.loaded/t.total*100,10),$("#progress .progress-bar").css("width",a+"%")},doneFile:function(e,t){return $(this).closest(".card-editor").find(".chosen-file").replaceWith(t.result),t.form.find("button[type=submit]").attr("disabled",!1)}}),$(window).ready(function(){return $("body").on("click",".cancel-upload",function(){var e;return(e=$(this).closest(".card-editor")).find(".choose-file").show(),e.find(".chosen-file").empty(),e.find(".progress").show(),e.find("#progress .progress-bar").css("width","0%"),e.find("#progress").hide()}),$("body").on("submit","form",function(){var e;if((e=$(this).find(".file-upload[type=file]"))[0])return e.prop("disabled",!0)})})}).call(this);