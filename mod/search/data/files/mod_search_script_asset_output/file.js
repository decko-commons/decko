// autocomplete.js.coffee
(function(){decko.slot.ready(function(e){return e.find("._autocomplete").each(function(){return decko.initAutoCardPlete($(this))}),e.find("._select2autocomplete").each(function(){return decko.select2Autocomplete.init($(this))})}),decko.initAutoCardPlete=function(e){var t,n;if(t=e.data("options-card"))return n=t+".json?view=name_match",e.autocomplete({source:decko.slot.path(n)})},decko.select2Autocomplete={init:function(e,t,n){var a;return a=$.extend({},this._defaults(e),t),n&&$.extend(a.ajax,n),e.select2(a)},_defaults:function(e){return{multiple:!1,width:"100%!important",minimumInputLength:0,maximumSelectionSize:1,placeholder:e.attr("placeholder"),templateResult:this._templateResult,templateSelection:this._templateSelection,escapeMarkup:function(e){return e},ajax:{delay:200,cache:!0,url:decko.path(":search.json"),processResults:function(e){return{results:this._prepareItems(e)}},data:function(e){return{query:{keyword:e.term},view:"complete"}}}}},_templateResult:function(e){return e.loading?e.text:this._templateSelection(e)},_templateSelection:function(e){return'<span class="search-box-item-value ml-1">'+e.text+"</span>"},_prepareItems:function(e){var t;return t=[],$.each(e.result,function(e,n){return t.push({id:n[0],text:n[0]})}),t}}}).call(this);
// search_box.js.coffee
(function(){$(window).ready(function(){var e;return e=$("._search-box"),decko.searchBox.init(e),e.on("select2:select",function(e){return decko.searchBox.select(e)})}),decko.searchBox={init:function(e){var t;return t=this._process,decko.select2Autocomplete.init(e,this._options(),{processResults:function(e){return{results:t(e)}},data:function(t){var r;return r={query:{keyword:t.term},view:"search_box_complete"},e.closest("form").serializeArray().map(function(e){return r[e.name]=e.value}),r}})},select:function(e){var t;return(t=e.params.data).href?window.location=decko.path(t.href):$(e.target).closest("form").submit(),$(e.target).attr("disabled","disabled")},_options:function(){return{minimumInputLength:1,containerCssClass:"select2-search-box-autocomplete",dropdownCssClass:"select2-search-box-dropdown",templateResult:this._templateResult,templateSelection:this._templateSelection,width:"100%"}},_templateResult:function(e){return e.loading?e.text:'<i class="material-icons">'+e.icon+'</i><span class="search-box-item-label">'+e.prefix+':</span> <span class="search-box-item-value">'+e.label+"</span>"},_templateSelection:function(e){return e.icon?'<i class="material-icons">'+e.icon+'</i><span class="search-box-item-value">'+e.label+"</span>":e.text},_process:function(e){var t,r;return t=decko.searchBox,r=[],e.search&&r.push(t._searchItem(e.term)),$.each(["add","new"],function(n,o){var a;if(a=e[o])return r.push(t._addItem(o,a))}),$.each(e.goto,function(e,n){return r.push(t._gotoItem(e,n))}),r},_searchItem:function(e){return this._normalizeItem({prefix:"search",id:e,text:e})},_addItem:function(e,t){return this._normalizeItem({prefix:e,icon:"add",text:t[0],href:t[1]})},_gotoItem:function(e,t){return this._normalizeItem({prefix:"go to",id:e,icon:"arrow_forward",text:t[0],href:t[1],label:t[2]})},_normalizeItem:function(e){return e.id||(e.id=e.prefix),e.icon||(e.icon=e.prefix),e.label||(e.label='<strong class="highlight">'+e.text+"</strong>"),e}}}).call(this);