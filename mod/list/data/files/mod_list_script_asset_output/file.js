// filter_items.js.coffee
(function(){var e,t;$.extend(decko,{itemAdded:function(t){return $("document").ready(function(){return $("body").on("itemAdded","._filtered-list-item",function(){return t.call(this,$(this))})})},itemsAdded:function(t){return $("document").ready(function(){return $("body").on("itemsAdded",".card-slot",function(){return t.call(this,$(this))})})}}),$(window).ready(function(){return $("body").on("click","._filter-items ._add-selected",function(){return $(this).closest(".modal").modal("hide"),t(this).addSelected()}),$("body").on("click","._select-all",function(){return t(this).selectAll(),$(this).prop("checked",!1)}),$("body").on("click","._deselect-all",function(){return t(this).deselectAll(),$(this).prop("checked",!0)}),$("body").on("click","._filter-items ._unselected input._checkbox-list-checkbox",function(){return t(this).selectAndUpdate(this)}),$("body").on("click","._filter-items ._selected input._checkbox-list-checkbox",function(){return t(this).deselectAndUpdate(this)}),$("body").on("click","._filtered-list-item-delete",function(){return $(this).closest("li").remove()})}),t=function(t){return new e(t)},e=function(){function t(t){this.box=$(t).closest("._filter-items"),this.bin=this.box.find("._selected-bin"),this.selected_items=this.box.find("._selected-item-list"),this.help_text=this.box.find("._filter-help"),this.addSelectedButton=this.box.find("._add-selected"),this.deselectAllLink=this.box.find("._deselect-all"),this.config=this.box.data()}return t.prototype.selectAll=function(){var t;return(t=this).box.find("._unselected input._checkbox-list-checkbox").each(function(){return t.select(this)}),this.updateOnSelect()},t.prototype.deselectAll=function(){var t;return(t=this).box.find("._selected input._checkbox-list-checkbox").each(function(){return t.deselect(this)}),this.updateOnSelect()},t.prototype.select=function(t){var e;return e=(t=$(t)).slot(),this.duplicatesOk()&&e.after(e.clone()),t.prop("checked",!0),this.bin.append(e)},t.prototype.deselect=function(t){return $(t).slot().remove()},t.prototype.selectAndUpdate=function(t){return this.select(t),this.updateOnSelect()},t.prototype.deselectAndUpdate=function(t){return this.deselect(t),this.updateOnSelect()},t.prototype.updateOnSelect=function(){return this.duplicatesOk()||(this.trackSelectedIds(),new decko.filter(this.box.find("._filter-widget")).update(),this.updateUnselectedCount()),this.updateSelectedCount()},t.prototype.sourceSlot=function(){return this.box.slot()},t.prototype.addSelected=function(){var t,e,i,n,d;for((d=this.sourceSlot().find(".submit-button")).attr("disabled",!0),e=0,i=(n=this.selectedIds()).length;e<i;e++)t=n[e],this.addSelectedCard(t);return d.attr("disabled",!1),this.sourceSlot().trigger("itemsAdded")},t.prototype.addSelectedCard=function(t){var e,i;return i=this.sourceSlot(),e=this,$.ajax({url:this.addSelectedUrl(t),async:!1,success:function(t){return e.addItem(i,$(t))},error:function(t,e){return i.notify("error: "+e,"error")}})},t.prototype.addItem=function(t,e){return t.find("._filtered-list").append(e),e.trigger("itemAdded"),!0},t.prototype.addSelectedUrl=function(t){return decko.path("~"+t+"/"+this.config.itemView+"?slot[wrap]="+this.config.itemWrap)},t.prototype.duplicatesOk=function(){return this.config.itemDuplicable},t.prototype.trackSelectedIds=function(){var t;return t=this.prefilteredIds().concat(this.selectedIds()),this.box.find("._not-ids").val(t.toString())},t.prototype.prefilteredIds=function(){return this.prefilteredData("cardId")},t.prototype.prefilteredData=function(t){var e;return e=this.sourceSlot().find(this.box.data("itemSelector")),this.arrayFromField(e,t)},t.prototype.selectedIds=function(){return this.selectedData("cardId")},t.prototype.selectedNames=function(){return this.selectedData("cardName")},t.prototype.selectedData=function(t){return this.arrayFromField(this.bin.children(),t)},t.prototype.arrayFromField=function(t,e){return t.map(function(){return $(this).data(e)}).toArray()},t.prototype.updateUnselectedCount=function(){var t;return t=this.box.find("._search-checkbox-list").children().length,this.box.find("._unselected-items").html(t),this.box.find("._select-all").attr("disabled",0<t)},t.prototype.updateSelectedCount=function(){var t;return t=this.bin.children().length,this.box.find("._selected-items").html(t),this.deselectAllLink.attr("disabled",0===t),this.addSelectedButton.attr("disabled",0===t),this.updateSelectedSectionVisibility(0<t)},t.prototype.updateSelectedSectionVisibility=function(t){return t?(this.selected_items.show(),this.help_text.hide()):(this.selected_items.hide(),this.help_text.show())},t}()}).call(this);
// pointer_config.js.coffee
(function(){var t,e;$.extend(decko.editorContentFunctionMap,{"select.pointer-select":function(){return e(this.val())},"select.pointer-multiselect":function(){return e(this.val())},".pointer-radio-list":function(){return e(this.find("input:checked").val())},".pointer-list-ul":function(){return e(this.find("input").map(function(){return $(this).val()}))},".pointer-link-list-ul":function(){return decko.linkListContent(this.find(".input-group"))},"._nest-list-ul":function(){return decko.nestListContent(this.find(".input-group"))},".pointer-checkbox-list":function(){return e(this.find("input:checked").map(function(){return $(this).val()}))},".pointer-select-list":function(){return e(this.find(".pointer-select select").map(function(){return $(this).val()}))},"._filtered-list":function(){return e(this.find("._filtered-list-item").map(function(){return $(this).data("cardName")}))},"._pointer-list":function(){return e(this.find("._pointer-item").map(function(){return $(this).val()}))},".perm-editor":function(){return t(this)}}),decko.editorInitFunctionMap[".pointer-list-editor"]=function(){return this.sortable({handle:".handle",cancel:""}),decko.initPointerList(this.find("input"))},decko.editorInitFunctionMap["._filtered-list"]=function(){return this.sortable({handle:"._handle",cancel:""})},$.extend(decko,{initPointerList:function(t){return decko.initAutoCardPlete(t)},pointerContent:function(t){return $.makeArray(t).join("\n")},linkListContent:function(t){var n,i;return i=t.map(function(){var t,n;return n=$(this).find("input._reference").val(),0<(t=$(this).find("input._title").val()).length&&(n+="|"+t),n}),n=$.map($.makeArray(i),function(t){if(t)return"[["+t+"]]"}),$.makeArray(n).join("\n")},nestListContent:function(t){var n,i;return i=t.map(function(){var t,n;return n=$(this).find("input._reference").val(),0<(t=$(this).find("input._nest-options").val()).length&&(n+="|"+t),n}),n=$.map($.makeArray(i),function(t){if(t)return"{{"+t+"}}"}),$.makeArray(n).join("\n")}}),e=function(t){return decko.pointerContent(t)},t=function(t){var n,i;return t.find("#inherit").is(":checked")?"_left":(n=t.find(".perm-group input:checked").map(function(){return $(this).val()}),i=t.find(".perm-indiv input").map(function(){return $(this).val()}),e($.makeArray(n).concat($.makeArray(i))))}}).call(this);
// pointer_list_editor.js.coffee
(function(){$(window).ready(function(){return $("body").on("click","._pointer-item-add",function(t){return decko.addPointerItem(this),t.preventDefault()}),$("body").on("keydown",".pointer-item-text",function(t){if("Enter"===t.key)return decko.addPointerItem(this),t.preventDefault()}),$("body").on("keyup",".pointer-item-text",function(){return decko.updateAddItemButton(this)}),$("body").on("click",".pointer-item-delete",function(){var t,e;return 1<(e=(t=$(this).closest("li")).closest("ul")).find(".pointer-li").length?t.remove():t.find("input").val(""),decko.updateAddItemButton(e)})}),decko.slotReady(function(t){return t.find(".pointer-list-editor").each(function(){return decko.updateAddItemButton(this)})}),$.extend(decko,{addPointerItem:function(t){var e,n;return(n=$(t).slot()).trigger("slotDestroy"),(e=decko.nextPointerInput(decko.lastPointerItem(t))).val(""),n.trigger("slotReady"),decko.initializeEditors(n),e.first().focus(),decko.updateAddItemButton(t),decko.initPointerList(e)},nextPointerInput:function(t){var e,n,i,o,d,r;for(e=!0,n=0,d=(o=t.find("input")).length;n<d;n++)i=o[n],e=e&&""===$(i).val();return e?o:(r=t.clone(),t.after(r),r.attr("data-index",parseInt(t.attr("data-index")+1)),r.find("input"))},lastPointerItem:function(t){return $(t).closest(".content-editor").find(".pointer-li:last")},updateAddItemButton:function(t){var e,n;return e=$(t).closest(".content-editor").find("._pointer-item-add"),n=""===decko.lastPointerItem(t).find("input").val(),e.prop("disabled",n)}})}).call(this);